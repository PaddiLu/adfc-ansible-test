---
- name: Setup ADFC Client
  hosts: arbeitsplatz
  gather_facts: false
  roles:
    - update_os
    - basic_setup
    - kde_debian
    - ssh_keys
    - ucs_client_join
    - inactivity_shutdown
    - load_contacts
    - postfix_auth
    - fonts
    - xrdp
    - unburden_home_dir
    - firefox_client
    - thunderbird
    - libreoffice
    - links_on_desktop
    - client_apt_remove
    - master_pdf_editor
    - gdm_desktoptheme
    - chromium_latest
    - moneyplex_settings
    - faime_downloader
    - arbeitsplatz
    - client_apt_remove
    - telefonanalyse
  handlers:
    - name: XnViewMP manuell installieren
      ansible.builtin.apt:
        deb: /usr/local/share/ansible_downloads/XnViewMP-linux-x64.deb

    - name: PDF-Editor manuell installieren
      ansible.builtin.apt:
        deb: /usr/local/share/ansible_downloads/{{ deb_name_master_pdf_editor }}

    - name: Apt-get update ausf√ºhren
      ansible.builtin.apt:
        update_cache: true
      tags: software

  pre_tasks:
    - name: Power on clients
      ansible.builtin.include_role:
        name: tasmota_power_on
      when: tasmota_wireless_ip is defined

    - name: Fakten einlesen
      ansible.builtin.setup:

    - name: Apt-get update
      ansible.builtin.apt:
        update_cache: true
      tags: software

  post_tasks:
    - name: Poweroff unused clients that were off before
      ansible.builtin.include_role:
        name: tasmota_power_off
      when: (tasmota_wireless_ip is defined) and (connect_result is failed)
